<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOUNEIM LIST</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #0d0d0d;
            --card-bg: #151515;
            --main-accent: #00ffcc; /* –¶–∏–∞–Ω */
            --secondary-accent: #ff00ff; /* –†–æ–∑–æ–≤—ã–π */
            --text-color: #ffffff;
            --rank-1: #ffd700;
            --rank-2: #c0c0c0;
            --rank-3: #cd7f32;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow-x: hidden;
        }

        /* --- –ê–Ω–∏–º–∞—Ü–∏–∏ --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.5s ease forwards; }

        @keyframes gradient-text {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- –®–∞–ø–∫–∞ --- */
        header {
            text-align: center;
            padding: 25px 0;
            border-bottom: 2px solid var(--main-accent);
            background: rgba(0,0,0,0.9);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(0, 255, 204, 0.1);
        }

        h1.logo {
            font-size: 3rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 20px;
            /* –ü–µ—Ä–µ–ª–∏–≤–∞—é—â–∏–π—Å—è —Ç–µ–∫—Å—Ç */
            background: linear-gradient(45deg, var(--secondary-accent), var(--main-accent), var(--secondary-accent));
            background-size: 200% auto;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: gradient-text 3s linear infinite;
        }

        nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: transparent;
            border: 2px solid var(--main-accent);
            color: var(--main-accent);
            padding: 10px 25px;
            cursor: pointer;
            font-weight: 700;
            text-transform: uppercase;
            transition: 0.3s;
            border-radius: 30px;
            font-size: 0.9rem;
        }

        .nav-btn:hover, .nav-btn.active {
            background: var(--main-accent);
            color: #000;
            box-shadow: 0 0 20px var(--main-accent);
            transform: scale(1.05);
        }
        
        /* –°—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫ –∞–¥–º–∏–Ω–∞ */
        .nav-btn.admin-btn {
            border-color: var(--secondary-accent);
            color: var(--secondary-accent);
        }
        .nav-btn.admin-btn:hover, .nav-btn.admin-btn.active {
            background: var(--secondary-accent);
            box-shadow: 0 0 20px var(--secondary-accent);
            color: white;
        }

        /* --- –ö–æ–Ω—Ç–µ–Ω—Ç --- */
        .container {
            max-width: 1000px;
            margin: 30px auto;
            padding: 0 15px;
            min-height: 80vh;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease; }

        /* --- –§–∏–ª—å—Ç—Ä—ã –∏ –ü–æ–ª—è --- */
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #333;
        }

        input, select, textarea {
            background: #222;
            border: 1px solid #444;
            color: white;
            padding: 12px;
            border-radius: 8px;
            outline: none;
            transition: 0.3s;
        }

        input:focus, select:focus {
            border-color: var(--main-accent);
            box-shadow: 0 0 10px rgba(0, 255, 204, 0.2);
        }

        input { flex-grow: 1; }

        /* --- –°–ø–∏—Å–æ–∫ –£—Ä–æ–≤–Ω–µ–π --- */
        .level-card {
            display: flex;
            align-items: center;
            background: var(--card-bg);
            margin-bottom: 15px;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid #333;
            height: 90px;
        }

        .level-card:hover {
            transform: scale(1.02);
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.5);
            border-color: var(--main-accent);
        }

        .level-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0.2;
            transition: 0.3s;
            filter: grayscale(80%);
        }
        .level-card:hover .level-bg { opacity: 0.4; filter: grayscale(0%); }

        .rank-box {
            width: 70px;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            font-weight: 900;
            z-index: 2;
            background: rgba(0,0,0,0.6);
            border-right: 1px solid #444;
        }

        /* –¢–æ–ø 3 –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ */
        .level-card[data-rank="1"] { border: 2px solid var(--rank-1); }
        .level-card[data-rank="1"] .rank-box { color: var(--rank-1); text-shadow: 0 0 10px var(--rank-1); }
        
        .level-card[data-rank="2"] { border: 2px solid var(--rank-2); }
        .level-card[data-rank="2"] .rank-box { color: var(--rank-2); text-shadow: 0 0 10px var(--rank-2); }

        .level-card[data-rank="3"] { border: 2px solid var(--rank-3); }
        .level-card[data-rank="3"] .rank-box { color: var(--rank-3); text-shadow: 0 0 10px var(--rank-3); }

        .info-box {
            flex-grow: 1;
            padding: 0 25px;
            z-index: 2;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-shadow: 2px 2px 5px #000;
        }

        .level-name { font-size: 1.4rem; font-weight: 800; text-transform: uppercase; }
        .level-difficulty { 
            font-weight: bold; 
            text-transform: uppercase;
            padding: 5px 12px;
            background: rgba(0,0,0,0.8);
            border-radius: 6px;
            font-size: 0.8rem;
            color: var(--main-accent);
            border: 1px solid var(--main-accent);
        }

        /* --- –ò–≥—Ä–æ–∫–∏ --- */
        .player-card {
            display: flex;
            align-items: center;
            background: #222;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 50px; /* –ö—Ä—É–≥–ª—ã–π —Å—Ç–∏–ª—å */
            border: 1px solid #444;
            cursor: pointer;
            transition: 0.3s;
        }
        .player-card:hover { transform: translateX(10px); border-color: var(--secondary-accent); }

        .player-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 20px;
            margin-left: 10px;
            border: 2px solid white;
        }

        /* –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è —Ñ–æ–Ω–∞ –∏–≥—Ä–æ–∫–∞ */
        .hardest-bg-Extreme { background: linear-gradient(90deg, #111 0%, #3a0000 100%); }
        .hardest-bg-Insane { background: linear-gradient(90deg, #111 0%, #2e002e 100%); }
        .hardest-bg-Hard { background: linear-gradient(90deg, #111 0%, #3a0000 100%); }
        .hardest-bg-Medium { background: linear-gradient(90deg, #111 0%, #3a2e00 100%); }
        .hardest-bg-Easy { background: linear-gradient(90deg, #111 0%, #002e3a 100%); }

        /* --- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ --- */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: #1a1a1a;
            padding: 40px;
            width: 95%;
            max-width: 700px;
            border-radius: 20px;
            border: 1px solid var(--main-accent);
            text-align: center;
            position: relative;
            box-shadow: 0 0 50px rgba(0,255,204,0.1);
            animation: fadeIn 0.3s;
        }

        .close-modal {
            position: absolute;
            top: 15px; right: 20px;
            font-size: 2.5rem;
            cursor: pointer;
            color: var(--secondary-accent);
            transition: 0.3s;
        }
        .close-modal:hover { transform: rotate(90deg); color: white; }

        .video-container {
            margin: 20px 0;
            position: relative;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #333;
        }
        .video-container iframe {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
        }

        .btn-action {
            background: #2a2a2a;
            color: white;
            border: 1px solid #555;
            padding: 12px;
            margin: 8px 0;
            cursor: pointer;
            width: 100%;
            border-radius: 8px;
            font-weight: bold;
            transition: 0.2s;
        }
        .btn-action:hover { background: var(--main-accent); color: black; border-color: var(--main-accent); }
        
        .btn-danger { border-color: red; color: red; background: rgba(50,0,0,0.5); }
        .btn-danger:hover { background: red; color: white; }

        .history-item { 
            border-left: 2px solid var(--main-accent);
            background: #111;
            padding: 10px;
            margin: 5px 0;
            text-align: left;
            font-size: 0.9rem;
        }

        /* --- –í—Ö–æ–¥ / –ê–∫–∫–∞—É–Ω—Ç --- */
        .auth-container {
            max-width: 400px;
            margin: 50px auto;
            background: #151515;
            padding: 40px;
            border-radius: 20px;
            border: 1px solid #333;
            text-align: center;
        }
        .auth-container h2 { color: var(--main-accent); margin-bottom: 20px; text-transform: uppercase; }
        .auth-container button { width: 100%; margin-top: 10px; padding: 15px; border-radius: 10px; border:none; font-weight: 900; cursor: pointer; }
        .btn-login { background: var(--main-accent); color: black; }
        .btn-reg { background: transparent; border: 2px solid #555 !important; color: #aaa; }
        
        .profile-head {
            text-align: center;
            margin-bottom: 20px;
        }
        .profile-head img {
            width: 120px; height: 120px;
            border-radius: 50%;
            border: 4px solid var(--secondary-accent);
            box-shadow: 0 0 20px rgba(255,0,255,0.4);
        }

        /* --- –î–µ–º–æ–Ω –ª–∏—Å—Ç—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ --- */
        .demon-list-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 15px;
            margin: 5px 0;
            background: #111;
            border-left: 5px solid;
            cursor: pointer;
            transition: 0.2s;
        }
        .demon-list-btn:hover { background: #222; padding-left: 20px; }
        .d-extreme { border-color: #ff0000; }
        .d-insane { border-color: #cc00cc; }
        .d-hard { border-color: #ffaa00; }

        .admin-panel-box {
            border: 1px dashed red;
            padding: 15px;
            margin-top: 20px;
            border-radius: 10px;
            background: rgba(255, 0, 0, 0.05);
            display: none;
        }

    </style>
</head>
<body>

    <header>
        <h1 class="logo">NOUNEIM LIST</h1>
        <nav>
            <button class="nav-btn active" onclick="app.switchTab('levels')">–£—Ä–æ–≤–Ω–∏</button>
            <button class="nav-btn" onclick="app.switchTab('players')">–ò–≥—Ä–æ–∫–∏</button>
            <button class="nav-btn" onclick="app.switchTab('submit')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <button class="nav-btn" onclick="app.switchTab('account')">–ê–∫–∫–∞—É–Ω—Ç</button>
            <button class="nav-btn admin-btn" id="nav-requests" style="display:none;" onclick="app.switchTab('requests')">–†–µ–∫–≤–µ—Å—Ç—ã</button>
        </nav>
    </header>

    <div class="container">

        <div id="tab-levels" class="tab-content active">
            <div class="controls">
                <button id="btn-create-level" class="nav-btn admin-btn" style="display:none;" onclick="app.openCreateLevel()">+ –°–æ–∑–¥–∞—Ç—å</button>
                <select id="sort-levels" onchange="app.renderLevels()">
                    <option value="points">–¢–æ–ø –ø–æ –±–∞–ª–ª–∞–º</option>
                    <option value="diff">–¢–æ–ø –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</option>
                </select>
                <input type="text" id="search-levels" placeholder="üîç –ù–∞–π—Ç–∏ —É—Ä–æ–≤–µ–Ω—å..." oninput="app.renderLevels()">
            </div>
            <div id="levels-container"></div>
        </div>

        <div id="tab-players" class="tab-content">
            <div class="controls">
                <select id="sort-players">
                    <option value="points">–ü–æ –±–∞–ª–ª–∞–º</option>
                    <option value="reputation">–ü–æ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏</option>
                </select>
                <input type="text" id="search-players" placeholder="üîç –ù–∞–π—Ç–∏ –∏–≥—Ä–æ–∫–∞...">
            </div>
            <div id="players-container"></div>
        </div>

        <div id="tab-submit" class="tab-content">
            <div class="modal-content" style="margin: 0 auto; text-align: left;">
                <h2 style="color: var(--main-accent); text-align:center; margin-bottom:20px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∫–æ—Ä–¥</h2>
                
                <label>–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å:</label>
                <select id="submit-level-list" style="width:100%; margin-bottom:10px;"></select>
                
                <button class="btn-action" onclick="document.getElementById('new-level-wrap').style.display = document.getElementById('new-level-wrap').style.display==='none'?'block':'none'">
                    –ò–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ù–û–í–´–ô —É—Ä–æ–≤–µ–Ω—å?
                </button>
                
                <div id="new-level-wrap" style="display:none; border:1px solid #444; padding:15px; margin:10px 0; border-radius:10px; background:#111;">
                    <p style="color:#aaa; font-size:0.8rem;">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ, –µ—Å–ª–∏ —É—Ä–æ–≤–Ω—è –Ω–µ—Ç –≤ —Ç–æ–ø–µ</p>
                    <input type="text" id="req-new-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è" style="margin-top:5px;">
                    <br><br>
                    <select id="req-diff">
                        <option value="Extreme Demon">Extreme Demon</option>
                        <option value="Insane Demon">Insane Demon</option>
                        <option value="Hard Demon">Hard Demon</option>
                        <option value="Medium Demon">Medium Demon</option>
                        <option value="Easy Demon">Easy Demon</option>
                    </select>
                </div>

                <label>–ü—Ä–æ–≥—Ä–µ—Å—Å (%):</label>
                <input type="number" id="req-progress" placeholder="100" value="100" max="100">
                
                <label>–í–∏–¥–µ–æ (YouTube):</label>
                <input type="text" id="req-video" placeholder="https://youtu.be/...">
                
                <label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:</label>
                <textarea id="req-comment" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." style="width:100%; height:80px;"></textarea>
                
                <button class="nav-btn" style="width:100%; margin-top:20px; background:var(--main-accent); color:black;" onclick="app.submitRequest()">–û–¢–ü–†–ê–í–ò–¢–¨</button>
            </div>
        </div>

        <div id="tab-account" class="tab-content">
            
            <div id="auth-forms" class="auth-container">
                <h2>–í—Ö–æ–¥</h2>
                <input type="text" id="auth-login" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –õ–æ–≥–∏–Ω">
                <input type="password" id="auth-pass" placeholder="–ü–∞—Ä–æ–ª—å">
                
                <button class="btn-login" onclick="app.login()">–í–û–ô–¢–ò</button>
                <button class="btn-reg" onclick="app.register()">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
                <div id="auth-error" style="color:red; margin-top:10px; font-size:0.9rem;"></div>
            </div>

            <div id="user-profile" style="display:none; max-width:600px; margin:0 auto;">
                <div class="modal-content" style="width:100%;">
                    <div class="profile-head">
                        <img id="my-avatar" src="" alt="Avatar">
                        <h2 id="my-name" style="margin-top:10px;">User</h2>
                        <h3 style="color:var(--main-accent)">PTS: <span id="my-pts">0</span></h3>
                        <div id="admin-badge" style="color:var(--secondary-accent); display:none; font-weight:900; letter-spacing:2px; margin-top:5px;">ADMIN</div>
                    </div>
                    
                    <div style="text-align:left; margin-top:20px;">
                        <label>–°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä (URL):</label>
                        <div style="display:flex; gap:5px;">
                            <input type="text" id="new-avatar-url" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É (.png/.jpg)">
                            <button onclick="app.updateAvatar()" style="width:auto; padding:0 15px; cursor:pointer;">OK</button>
                        </div>
                    </div>

                    <div style="margin-top:30px; border-top:1px solid #333; padding-top:20px;">
                        <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è / –ß–∞—Ç</h3>
                        <div id="my-chat-list" style="height:150px; overflow-y:auto; background:#111; padding:10px; margin-top:10px; border-radius:8px; text-align:left;">
                            <p style="color:#555">–ù–µ—Ç –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.</p>
                        </div>
                    </div>

                    <button class="btn-action btn-danger" onclick="app.logout()" style="margin-top:30px;">–í–´–ô–¢–ò</button>
                </div>
            </div>
        </div>

        <div id="tab-requests" class="tab-content">
            <h2 style="text-align:center; margin-bottom:20px;">–ó–∞—è–≤–∫–∏ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É</h2>
            <div id="requests-list"></div>
        </div>

    </div>

    <div id="level-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="app.closeModal('level-modal')">&times;</span>
            
            <h2 id="m-lvl-name" style="font-size:2rem; color:white;">Level Name</h2>
            <p id="m-lvl-creator" style="color:var(--main-accent); margin-bottom:15px; font-weight:bold;">by Creator</p>
            
            <div class="video-container">
                <iframe id="m-lvl-video" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            
            <div style="display:flex; gap:10px;">
                <button class="btn-action" onclick="app.copyID()">ID: <span id="m-lvl-id"></span> (–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å)</button>
                <button class="btn-action" onclick="document.getElementById('history-box').style.display = document.getElementById('history-box').style.display==='none'?'block':'none'">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∑–∏—Ü–∏–π</button>
            </div>

            <div id="history-box" style="display:none; margin:10px 0;">
                </div>

            <h3 style="margin-top:20px; border-bottom:1px solid #333; padding-bottom:10px;">–†–µ–∫–æ—Ä–¥—ã</h3>
            <div id="m-lvl-records" style="text-align:left; max-height:200px; overflow-y:auto;">
                <p style="color:#555; text-align:center; padding:10px;">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∫–æ—Ä–¥–æ–≤</p>
            </div>

            <div id="lvl-admin-panel" class="admin-panel-box">
                <h4>ADMIN ZONE</h4>
                <button class="btn-action btn-danger" onclick="app.deleteLevel()">–£–¥–∞–ª–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—Å–µ–≥–¥–∞</button>
            </div>
        </div>
    </div>

    <div id="player-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="app.closeModal('player-modal')">&times;</span>
            <img id="p-avatar" src="" style="width:100px; height:100px; border-radius:50%; border:3px solid var(--main-accent);">
            <h2 id="p-name" style="margin:10px 0;">Name</h2>
            <p style="font-size:1.2rem;">–ë–∞–ª–ª—ã: <span id="p-pts" style="color:var(--main-accent); font-weight:bold;">0</span></p>
            
            <div style="background:#111; padding:10px; margin:15px 0; border-radius:10px; display:flex; justify-content:center; align-items:center; gap:15px;">
                <span>–†–µ–ø—É—Ç–∞—Ü–∏—è: <b id="p-rep" style="color:white; font-size:1.2rem;">0</b></span>
                <div>
                    <button onclick="app.changeRep(1)" style="background:green; color:white; border:none; width:30px; height:30px; border-radius:5px; cursor:pointer;">+</button>
                    <button onclick="app.changeRep(-1)" style="background:red; color:white; border:none; width:30px; height:30px; border-radius:5px; cursor:pointer;">-</button>
                </div>
            </div>

            <div id="p-demon-lists">
                <div class="demon-list-btn d-extreme" onclick="alert('–§—É–Ω–∫—Ü–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">Extreme Demons</div>
                <div class="demon-list-btn d-insane" onclick="alert('–§—É–Ω–∫—Ü–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">Insane Demons</div>
                <div class="demon-list-btn d-hard" onclick="alert('–§—É–Ω–∫—Ü–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">Hard Demons</div>
            </div>

            <div style="margin-top:20px;">
                <input type="text" id="chat-msg" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="width:70%;">
                <button class="nav-btn" style="padding:10px;" onclick="app.sendMessage()">Send</button>
            </div>

             <div id="player-admin-panel" class="admin-panel-box">
                <h4>ADMIN ZONE</h4>
                <button class="btn-action btn-danger" onclick="app.banUser()">–ó–ê–ë–ê–ù–ò–¢–¨ –ò–ì–†–û–ö–ê</button>
                <button class="btn-action" onclick="app.resetRep()">–°–±—Ä–æ—Å–∏—Ç—å —Ä–µ–ø—É—Ç–∞—Ü–∏—é</button>
            </div>
        </div>
    </div>

    <div id="create-level-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="app.closeModal('create-level-modal')">&times;</span>
            <h2 style="margin-bottom:20px;">–î–æ–±–∞–≤–∏—Ç—å –£—Ä–æ–≤–µ–Ω—å</h2>
            
            <input type="text" id="c-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è" style="margin-bottom:10px; width:100%;">
            <input type="text" id="c-creator" placeholder="–°–æ–∑–¥–∞—Ç–µ–ª—å (–ù–∏–∫)" style="margin-bottom:10px; width:100%;">
            <input type="text" id="c-id" placeholder="ID —É—Ä–æ–≤–Ω—è (—Ü–∏—Ñ—Ä—ã)" style="margin-bottom:10px; width:100%;">
            <input type="text" id="c-video" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ YouTube" style="margin-bottom:10px; width:100%;">
            <input type="text" id="c-preview" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–µ–≤—å—é (–∫–∞—Ä—Ç–∏–Ω–∫–∞)" style="margin-bottom:10px; width:100%;">
            
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                <input type="number" id="c-points" placeholder="–ë–∞–ª–ª—ã" style="width:30%;">
                <select id="c-diff" style="width:70%;">
                    <option value="Extreme Demon">Extreme Demon</option>
                    <option value="Insane Demon">Insane Demon</option>
                    <option value="Hard Demon">Hard Demon</option>
                    <option value="Medium Demon">Medium Demon</option>
                    <option value="Easy Demon">Easy Demon</option>
                </select>
            </div>
            
            <button class="nav-btn" style="width:100%;" onclick="app.createLevel()">–°–û–ó–î–ê–¢–¨</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, update, remove, get } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyC2kE0eAffr3S7tnax0Ym9int4MvNlucg4",
            authDomain: "nouneimlist.firebaseapp.com",
            databaseURL: "https://nouneimlist-default-rtdb.firebaseio.com",
            projectId: "nouneimlist",
            storageBucket: "nouneimlist.firebasestorage.app",
            messagingSenderId: "871712258235",
            appId: "1:871712258235:web:982874240dd587d749119e"
        };

        const appInstance = initializeApp(firebaseConfig);
        const db = getDatabase(appInstance);
        const auth = getAuth(appInstance);

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let currentUser = null;
        let userData = null;
        let currentLevelKey = null; // ID —É—Ä–æ–≤–Ω—è –≤ –ë–î
        let currentPlayerKey = null;

        // --- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ---

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è ID –∏–∑ –ª—é–±–æ–π —Å—Å—ã–ª–∫–∏ YouTube
        function extractVideoID(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        // --- –ì–õ–ê–í–ù–´–ô –û–ë–™–ï–ö–¢ APP ---
        window.app = {
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è
            switchTab: (tabId) => {
                document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
                document.getElementById('tab-' + tabId).classList.add('active');
                
                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫
                document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
                if(event && event.target) event.target.classList.add('active');
            },

            closeModal: (id) => {
                document.getElementById(id).style.display = 'none';
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–µ–æ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
                const iframe = document.querySelector(`#${id} iframe`);
                if(iframe) iframe.src = ""; 
            },

            openCreateLevel: () => document.getElementById('create-level-modal').style.display = 'flex',

            // --- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ---
            
            // –í—Ö–æ–¥ –ø–æ –õ–æ–≥–∏–Ω—É (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º –¥–æ–º–µ–Ω)
            login: () => {
                const loginInput = document.getElementById('auth-login').value.trim();
                const pass = document.getElementById('auth-pass').value;
                const errBox = document.getElementById('auth-error');

                if(!loginInput || !pass) {
                    errBox.innerText = "–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å!";
                    return;
                }

                // –°–æ–∑–¥–∞–µ–º "—Ñ–∏–∫—Ç–∏–≤–Ω—ã–π" email
                const email = loginInput + "@nouneim.list";

                signInWithEmailAndPassword(auth, email, pass)
                    .then(() => { errBox.innerText = ""; })
                    .catch(e => {
                        console.error(e);
                        errBox.innerText = "–û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å."; 
                    });
            },

            // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
            register: () => {
                const loginInput = document.getElementById('auth-login').value.trim();
                const pass = document.getElementById('auth-pass').value;
                const errBox = document.getElementById('auth-error');

                if(pass.length < 6) {
                    errBox.innerText = "–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (–º–∏–Ω 6 —Å–∏–º–≤–æ–ª–æ–≤)";
                    return;
                }

                const email = loginInput + "@nouneim.list";

                createUserWithEmailAndPassword(auth, email, pass).then((cred) => {
                    // –ü–†–û–í–ï–†–ö–ê –ù–ê –ê–î–ú–ò–ù–ê (–°–∫—Ä—ã—Ç–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞)
                    const isAdmin = (pass === '423frwefsuio'); 
                    
                    const newUser = {
                        username: loginInput, // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∏—Å—Ç—ã–π –ª–æ–≥–∏–Ω
                        role: isAdmin ? 'admin' : 'user',
                        points: 0,
                        reputation: 0,
                        avatar: 'https://via.placeholder.com/150/00ffcc/000000?text=' + loginInput[0],
                        hardest: 'Hard Demon'
                    };
                    set(ref(db, 'users/' + cred.user.uid), newUser);
                }).catch(e => {
                    if(e.code === 'auth/email-already-in-use') errBox.innerText = "–≠—Ç–æ—Ç –ª–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç!";
                    else errBox.innerText = "–û—à–∏–±–∫–∞: " + e.message;
                });
            },

            logout: () => signOut(auth),

            updateAvatar: () => {
                const url = document.getElementById('new-avatar-url').value;
                if(url && currentUser) {
                    update(ref(db, 'users/' + currentUser.uid), { avatar: url });
                    alert("–ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!");
                }
            },

            // --- –õ–û–ì–ò–ö–ê –£–†–û–í–ù–ï–ô ---
            
            createLevel: () => {
                const vidUrl = document.getElementById('c-video').value;
                const vidID = extractVideoID(vidUrl);

                if(!vidID) return alert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ YouTube!");

                const newLvl = {
                    name: document.getElementById('c-name').value,
                    creator: document.getElementById('c-creator').value,
                    id: document.getElementById('c-id').value,
                    video: vidID, // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ ID
                    preview: document.getElementById('c-preview').value,
                    points: parseInt(document.getElementById('c-points').value) || 0,
                    difficulty: document.getElementById('c-diff').value,
                    created_at: new Date().toLocaleDateString()
                };
                
                push(ref(db, 'levels'), newLvl);
                app.closeModal('create-level-modal');
                alert("–£—Ä–æ–≤–µ–Ω—å —Å–æ–∑–¥–∞–Ω!");
            },

            renderLevels: () => {
                const search = document.getElementById('search-levels').value.toLowerCase();
                const sort = document.getElementById('sort-levels').value;
                
                onValue(ref(db, 'levels'), (snapshot) => {
                    const data = snapshot.val();
                    const container = document.getElementById('levels-container');
                    const select = document.getElementById('submit-level-list');
                    
                    container.innerHTML = '';
                    select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å --</option>';

                    if (!data) return;

                    let levels = Object.entries(data).map(([key, val]) => ({key, ...val}));

                    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
                    if(sort === 'points') {
                        levels.sort((a,b) => b.points - a.points);
                    } else {
                        // –°–ª–æ–∂–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ –ø–æ –æ—á–∫–∞–º)
                        levels.sort((a,b) => b.points - a.points);
                    }

                    levels.forEach((lvl, index) => {
                        if(lvl.name.toLowerCase().includes(search)) {
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∫–æ—Ä–¥–∞
                            select.innerHTML += `<option value="${lvl.key}">${lvl.name}</option>`;

                            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
                            const rank = index + 1;
                            const div = document.createElement('div');
                            div.className = 'level-card fade-in';
                            div.setAttribute('data-rank', rank);
                            div.onclick = () => app.openLevelModal(lvl, rank);
                            
                            const bgStyle = lvl.preview ? `background-image: url(${lvl.preview});` : 'background-color: #222;';

                            div.innerHTML = `
                                <div class="level-bg" style="${bgStyle}"></div>
                                <div class="rank-box">#${rank}</div>
                                <div class="info-box">
                                    <div class="level-name">${lvl.name}</div>
                                    <div class="level-difficulty">${lvl.difficulty}</div>
                                </div>
                            `;
                            container.appendChild(div);
                        }
                    });
                });
            },

            openLevelModal: (lvl, rank) => {
                currentLevelKey = lvl.key;
                const modal = document.getElementById('level-modal');
                
                document.getElementById('m-lvl-name').innerText = lvl.name;
                document.getElementById('m-lvl-creator').innerText = "by " + lvl.creator;
                document.getElementById('m-lvl-id').innerText = lvl.id;
                
                // –í—Å—Ç–∞–≤–ª—è–µ–º –≤–∏–¥–µ–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
                document.getElementById('m-lvl-video').src = `https://www.youtube.com/embed/${lvl.video}`;
                
                // –ò—Å—Ç–æ—Ä–∏—è (—Ñ–µ–π–∫–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è, –µ—Å–ª–∏ –Ω–µ—Ç –≤ –ë–î)
                const histBox = document.getElementById('history-box');
                histBox.innerHTML = `
                    <div class="history-item">–ü–æ—Å—Ç–∞–≤–ª–µ–Ω –Ω–∞ ${rank} –º–µ—Å—Ç–æ (${lvl.created_at || '–ù–µ–¥–∞–≤–Ω–æ'})</div>
                `;

                // –†–µ–∫–æ—Ä–¥—ã (–∑–∞–≥–ª—É—à–∫–∞ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞)
                // TODO: –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∫–æ—Ä–¥—ã –∏–∑ –ë–î (levels/id/records)
                
                // –ê–¥–º–∏–Ω–∫–∞
                if(userData && userData.role === 'admin') {
                    document.getElementById('lvl-admin-panel').style.display = 'block';
                } else {
                    document.getElementById('lvl-admin-panel').style.display = 'none';
                }

                modal.style.display = 'flex';
            },

            copyID: () => {
                const text = document.getElementById('m-lvl-id').innerText;
                navigator.clipboard.writeText(text);
                alert("ID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!");
            },

            deleteLevel: () => {
                if(confirm('–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                    remove(ref(db, 'levels/' + currentLevelKey));
                    app.closeModal('level-modal');
                }
            },

            // --- –û–¢–ü–†–ê–í–ö–ê –†–ï–ö–û–†–î–û–í ---
            
            submitRequest: () => {
                if(!currentUser) return alert("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç!");
                
                const lvlId = document.getElementById('submit-level-list').value;
                const isNew = document.getElementById('new-level-wrap').style.display === 'block';
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∏
                if(!isNew && !lvlId) return alert("–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å –∏–∑ —Å–ø–∏—Å–∫–∞!");
                
                const vidUrl = document.getElementById('req-video').value;
                if(!extractVideoID(vidUrl)) return alert("–ù—É–∂–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ YouTube –≤–∏–¥–µ–æ!");

                const req = {
                    userId: currentUser.uid,
                    userName: userData.username,
                    levelId: lvlId,
                    levelName: isNew ? document.getElementById('req-new-name').value : "", // –ï—Å–ª–∏ –Ω–æ–≤—ã–π
                    difficulty: isNew ? document.getElementById('req-diff').value : "",
                    progress: document.getElementById('req-progress').value,
                    video: vidUrl,
                    comment: document.getElementById('req-comment').value,
                    status: 'pending',
                    timestamp: Date.now()
                };
                
                push(ref(db, 'requests'), req);
                alert("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º!");
                // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
                document.getElementById('req-video').value = '';
                document.getElementById('req-comment').value = '';
            },

            // --- –ò–ì–†–û–ö–ò –ò –ê–î–ú–ò–ù–ö–ê ---
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–µ–Ω–¥–µ—Ä –∑–∞—è–≤–æ–∫ (–¥–ª—è –∞–¥–º–∏–Ω–∞)
            loadRequests: () => {
                onValue(ref(db, 'requests'), (snap) => {
                    const list = document.getElementById('requests-list');
                    list.innerHTML = '';
                    const data = snap.val();
                    if(!data) {
                        list.innerHTML = '<p style="text-align:center; color:#555">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫</p>';
                        return;
                    }
                    
                    Object.entries(data).forEach(([key, req]) => {
                        const div = document.createElement('div');
                        div.style.border = '1px solid #444';
                        div.style.background = '#111';
                        div.style.padding = '15px';
                        div.style.marginBottom = '15px';
                        div.style.borderRadius = '10px';
                        
                        div.innerHTML = `
                            <p><strong>–ò–≥—Ä–æ–∫:</strong> ${req.userName}</p>
                            <p><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> ${req.levelName || '–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π ID: ' + req.levelId}</p>
                            <p><strong>–ü—Ä–æ–≥—Ä–µ—Å—Å:</strong> ${req.progress}%</p>
                            <p><strong>–í–∏–¥–µ–æ:</strong> <a href="${req.video}" target="_blank" style="color:var(--main-accent)">–°–º–æ—Ç—Ä–µ—Ç—å</a></p>
                            <div style="margin-top:10px; display:flex; gap:10px;">
                                <button onclick="window.processReq('${key}', true)" style="background:green; color:white; border:none; padding:8px; cursor:pointer;">–ü—Ä–∏–Ω—è—Ç—å</button>
                                <button onclick="window.processReq('${key}', false)" style="background:red; color:white; border:none; padding:8px; cursor:pointer;">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                            </div>
                        `;
                        list.appendChild(div);
                    });
                });
            },

            banUser: () => {
                if(confirm("–ó–ê–ë–ê–ù–ò–¢–¨ –∏–≥—Ä–æ–∫–∞ –Ω–∞–≤—Å–µ–≥–¥–∞?")) {
                    update(ref(db, 'users/' + currentPlayerKey), { banned: true, points: 0 });
                    alert("–ò–≥—Ä–æ–∫ –∑–∞–±–∞–Ω–µ–Ω.");
                    app.closeModal('player-modal');
                }
            },
            
            changeRep: (amount) => {
                // –¢—É—Ç —É–ø—Ä–æ—â–µ–Ω–Ω–æ. –í –∏–¥–µ–∞–ª–µ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∫—Ç–æ –∫–æ–º—É —Å—Ç–∞–≤–∏–ª —Ä–µ–ø—É—Ç–∞—Ü–∏—é
                const newRep = (parseInt(document.getElementById('p-rep').innerText) || 0) + amount;
                update(ref(db, 'users/' + currentPlayerKey), { reputation: newRep });
            },

            sendMessage: () => {
                // –ó–∞–≥–ª—É—à–∫–∞ —á–∞—Ç–∞
                alert("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (—Å–∏–º—É–ª—è—Ü–∏—è)");
                document.getElementById('chat-msg').value = '';
            }
        };

        // --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ (Admin Requests) ---
        window.processReq = (key, accepted) => {
            if(accepted) {
                // –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –∏–≥—Ä–æ–∫—É, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞ –≤ —É—Ä–æ–≤–µ–Ω—å
                // –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è, –∑–¥–µ—Å—å –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è–µ–º –∑–∞—è–≤–∫—É
                alert("–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞! (–ë–∞–ª–ª—ã –ø–æ–∫–∞ –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã - –Ω—É–∂–Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–∏–∫–∏)");
                remove(ref(db, 'requests/' + key));
            } else {
                if(confirm("–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É?")) remove(ref(db, 'requests/' + key));
            }
        };

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–ª—É—à–∞—Ç–µ–ª–∏ ---
        
        // –†–µ–Ω–¥–µ—Ä –∏–≥—Ä–æ–∫–æ–≤
        onValue(ref(db, 'users'), (snap) => {
            const container = document.getElementById('players-container');
            container.innerHTML = '';
            const data = snap.val();
            if(!data) return;

            // –§–∏–ª—å—Ç—Ä—É–µ–º –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º
            let players = Object.entries(data)
                .map(([key, val]) => ({key, ...val}))
                .filter(u => !u.banned)
                .sort((a,b) => b.points - a.points); // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –æ—á–∫–∞–º

            players.forEach((p, index) => {
                const div = document.createElement('div');
                div.className = `player-card hardest-bg-${p.hardest ? p.hardest.split(' ')[0] : 'Easy'}`;
                
                div.innerHTML = `
                    <div style="font-weight:900; width:30px; text-align:center;">#${index+1}</div>
                    <img class="player-avatar" src="${p.avatar}">
                    <div style="flex-grow:1;">
                        <div style="font-weight:bold; font-size:1.1rem;">${p.username}</div>
                        <div style="font-size:0.8rem; color:#ccc;">${p.points} PTS</div>
                    </div>
                `;
                
                div.onclick = () => {
                    currentPlayerKey = p.key;
                    document.getElementById('p-avatar').src = p.avatar;
                    document.getElementById('p-name').innerText = p.username;
                    document.getElementById('p-pts').innerText = p.points;
                    document.getElementById('p-rep').innerText = p.reputation || 0;
                    
                    if(userData && userData.role === 'admin') {
                        document.getElementById('player-admin-panel').style.display = 'block';
                    } else {
                        document.getElementById('player-admin-panel').style.display = 'none';
                    }
                    
                    document.getElementById('player-modal').style.display = 'flex';
                }
                
                container.appendChild(div);
            });
        });

        // –°–ª—É—à–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∞
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            const authDiv = document.getElementById('auth-forms');
            const profileDiv = document.getElementById('user-profile');
            const adminBtns = document.querySelectorAll('.admin-btn');

            if (user) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª
                authDiv.style.display = 'none';
                profileDiv.style.display = 'block';

                onValue(ref(db, 'users/' + user.uid), (snap) => {
                    userData = snap.val();
                    if(!userData) return; // –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö

                    document.getElementById('my-name').innerText = userData.username;
                    document.getElementById('my-pts').innerText = userData.points;
                    document.getElementById('my-avatar').src = userData.avatar;

                    // –ï—Å–ª–∏ –ê–¥–º–∏–Ω
                    if(userData.role === 'admin') {
                        document.getElementById('admin-badge').style.display = 'block';
                        document.getElementById('nav-requests').style.display = 'inline-block';
                        document.getElementById('btn-create-level').style.display = 'inline-block';
                        app.loadRequests(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞—è–≤–∫–∏
                    }
                });
            } else {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª
                authDiv.style.display = 'block';
                profileDiv.style.display = 'none';
                document.getElementById('nav-requests').style.display = 'none';
                document.getElementById('btn-create-level').style.display = 'none';
                userData = null;
            }
        });

        // –ó–∞–ø—É—Å–∫
        app.renderLevels();

    </script>
</body>
</html>
